<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Termék módosítása: {{ azonosito }}</title>
    <script>
        // Geolokáció kérése és küldése a szerverre
        window.onload = function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(sendLocation, handleError);
            } else {
                console.log("Geolokáció nem támogatott.");
            }
        };

        function sendLocation(position) {
            fetch('/log_location/{{ azonosito }}', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lat: position.coords.latitude,
                    long: position.coords.longitude
                })
            }).then(response => {
                if (response.ok) {
                    console.log("Hely rögzítve.");
                } else {
                    console.error("Hiba a hely rögzítésekor.");
                }
            });
        }

        function handleError(error) {
            console.error("Geolokáció hiba: " + error.message);
        }

        // Mentés funkció (eredeti marad, de hozzáadva az onload-hoz)
        function saveChanges() {
            const form = document.getElementById('editForm');
            const data = {};
            new FormData(form).forEach((value, key) => { data[key] = value; });
            fetch('/edit/{{ azonosito }}', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            }).then(response => {
                if (response.ok) {
                    alert("Változások mentve!");
                } else {
                    alert("Hiba a mentés során.");
                }
            });
        }
    </script>
</head>
<body>
    <h1>Termék módosítása: {{ azonosito }}</h1>
    <form id="editForm">
        {% for field in mezok %}
            <div>
                <label for="{{ field }}">{{ field }}</label>
                {% if field == 'Azonosító' %}
                    <input type="text" id="{{ field }}" name="{{ field }}" value="{{ row[field] }}" readonly>
                {% elif field in listak %}
                    <select id="{{ field }}" name="{{ field }}">
                        {% for option in listak[field] %}
                            <option value="{{ option }}" {% if row[field] == option %}selected{% endif %}>{{ option }}</option>
                        {% endfor %}
                    </select>
                {% else %}
                    <input type="text" id="{{ field }}" name="{{ field }}" value="{{ row[field] }}">
                {% endif %}
            </div>
        {% endfor %}
        <button type="button" onclick="saveChanges()">Mentés</button>
    </form>
</body>
</html>